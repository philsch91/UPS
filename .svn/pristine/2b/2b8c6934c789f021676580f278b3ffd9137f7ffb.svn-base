using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Net;
using System.Web.Script.Serialization;
using System.Collections;
using System.Collections.Specialized;

namespace UPS {
    public class DayBooking : Booking {

        public DayBooking() {
        }

        public string Send() {

            string unixTimestamp = DateTime.Today.Subtract(new DateTime(1970, 1, 1)).TotalSeconds.ToString();
            string timestamp = unixTimestamp + "000";

            //Hashtable postdata = new Hashtable();
            //postdata.Add("taskId", taskId);
            //postdata.Add("taskName", "Citrix-General");
            //postdata.Add("taskName", "Jboss, Linux, Apache, Loadbalancing - AEV");
            //postdata.Add("date", "1499810400000");    //added 000
            //postdata.Add("tenant", settings["tenantvalue"]);

            Hashtable postdata = new Hashtable();
            postdata.Add("taskId", taskId);
            postdata.Add("date", timestamp);
            
            postdata.Add("duration", 1);
            //postdata.Add("category", "OP");             //in comboBoxCategory
            //postdata.Add
            postdata.Add("activity", activity);
            postdata.Add("userId", settings["userid"]);
            //postdata.Add("taskId", "2017-01-26 17:11:27.030806");       //taskId in listTask    //Jboss,Linux,Apache,Loadbalancing-AEV
            postdata.Add("taskId", taskId);

            JavaScriptSerializer serializer = new JavaScriptSerializer();
            string json = serializer.Serialize(postdata);

            //MessageBox.Show(json);
            //MessageBox.Show(webclient.ToString());

            string cookies = "";
            foreach(string cookie in webclient.Headers.GetValues("Cookie")) {
                cookies = cookies + cookie;
            }
            MessageBox.Show("WebClient Cookies" + Environment.NewLine + cookies);

            string s = "";
            s = webclient.UploadString("https://projectsuite.aeat.allianz.at/projectsuite/rest/workingStep", json);
            //MessageBox.Show(s);

            return "";
        }
    }
}
